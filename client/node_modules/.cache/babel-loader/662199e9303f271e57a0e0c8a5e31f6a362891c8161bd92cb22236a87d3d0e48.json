{"ast":null,"code":"const SERVER_API_URL = 'http://localhost:3001/api';\nvar fetchMethods = /*#__PURE__*/function (fetchMethods) {\n  fetchMethods[\"POST\"] = \"POST\";\n  fetchMethods[\"GET\"] = \"GET\";\n  fetchMethods[\"PUT\"] = \"PUT\";\n  fetchMethods[\"DELETE\"] = \"DELETE\";\n  return fetchMethods;\n}(fetchMethods || {});\nexport default class ExpressAPI {\n  constructor() {\n    // Create a User\n    this.createUser = async data => {\n      const response = await this.makeApiCall(fetchMethods.POST, '/auth/register', data);\n      return response;\n    };\n    // Log a user in\n    this.logUserIn = async data => {\n      const response = await this.makeApiCall(fetchMethods.POST, '/auth/login', data);\n      return response;\n    };\n    // Log a user out\n    this.logUserOut = async () => {\n      const response = await this.makeApiCall(fetchMethods.POST, '/auth/logout');\n      return response;\n    };\n    // Get a single user\n    this.getUser = async () => {\n      const response = await this.makeApiCall(fetchMethods.GET, '/user');\n      return response;\n    };\n    // Get all users currently logged in\n    this.getLoggedInUsers = async () => {\n      const response = await this.makeApiCall(fetchMethods.GET, '/user/logged-in');\n      return response;\n    };\n    // Check to see if a form fields, value already a value in an existing User document in the DB. \n    this.fieldExistsInDB = async (fieldName, value) => {\n      const response = await this.makeApiCall(fetchMethods.GET, `/user/exists/${fieldName}/${value}`);\n      return response;\n    };\n    // Create a new Game of chess\n    this.createGame = async (data, callback) => {\n      const response = await this.makeApiCall(fetchMethods.POST, '/game/create-game', data);\n      const responseData = await response.json();\n      if (response.ok) {\n        callback(responseData.gameId);\n      }\n      return response;\n    };\n    // Fetch wrapper\n    this.makeApiCall = async function (method, endpoint) {\n      let data = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n      const url = `${SERVER_API_URL}${endpoint}`;\n      const headers = new Headers();\n      headers.append('Content-Type', 'application/json');\n      const requestOptions = {\n        method,\n        headers,\n        credentials: 'include' // Include http-only cookies\n      };\n\n      if (method === 'POST') {\n        requestOptions.body = JSON.stringify(data);\n      }\n      const response = await fetch(url, requestOptions);\n      if (response.status === 401) {\n        const errorData = await response.json();\n        if (errorData.message === 'Session has expired. Please log in again.') {\n          const refreshResponse = await fetch(`${SERVER_API_URL}/api/auth/refresh`, {\n            method: 'POST',\n            credentials: 'include'\n          });\n          if (!refreshResponse.ok) {\n            throw new Error('Unable to refresh tokens');\n          }\n          const retryResponse = await fetch(url, requestOptions);\n          return retryResponse;\n        }\n      }\n      return response;\n    };\n  }\n}","map":{"version":3,"names":["SERVER_API_URL","fetchMethods","ExpressAPI","constructor","createUser","data","response","makeApiCall","POST","logUserIn","logUserOut","getUser","GET","getLoggedInUsers","fieldExistsInDB","fieldName","value","createGame","callback","responseData","json","ok","gameId","method","endpoint","arguments","length","undefined","url","headers","Headers","append","requestOptions","credentials","body","JSON","stringify","fetch","status","errorData","message","refreshResponse","Error","retryResponse"],"sources":["/home/jake/rem-stack/chess/client/src/api/express-api.ts"],"sourcesContent":["const SERVER_API_URL= 'http://localhost:3001/api'\n\nenum fetchMethods {\n  POST = 'POST',\n  GET = 'GET',\n  PUT = 'PUT',\n  DELETE = 'DELETE',\n}\n\nexport default class ExpressAPI {\n\n  // Create a User\n  createUser = async (data: Object): Promise<Response> => {\n    const response = await this.makeApiCall(fetchMethods.POST, '/auth/register', data)\n    return response\n  }\n\n  // Log a user in\n  logUserIn = async (data: object): Promise<Response> => {\n    const response = await this.makeApiCall(fetchMethods.POST, '/auth/login', data)\n    return response;\n  }\n\n  // Log a user out\n  logUserOut = async (): Promise<Response> => {\n    const response = await this.makeApiCall(fetchMethods.POST, '/auth/logout');\n    return response;\n  }\n\n  // Get a single user\n  getUser = async (): Promise<any> => {\n    const response = await this.makeApiCall(fetchMethods.GET, '/user');\n    return response;\n  }\n\n  // Get all users currently logged in\n  getLoggedInUsers = async (): Promise<any> => {\n    const response = await this.makeApiCall(fetchMethods.GET, '/user/logged-in');\n    return response;\n  }\n\n  // Check to see if a form fields, value already a value in an existing User document in the DB. \n  fieldExistsInDB = async (fieldName: string, value: any): Promise<Response> => {\n    const response = await this.makeApiCall(fetchMethods.GET,`/user/exists/${fieldName}/${value}`);\n    return response;\n  }\n\n  // Create a new Game of chess\n  createGame = async (data: object, callback: (gameId: string) => void): Promise<Response> => {\n    const response = await this.makeApiCall(fetchMethods.POST, '/game/create-game', data);\n    const responseData = await response.json();\n    if (response.ok) {\n      callback(responseData.gameId);\n    }\n    return response;\n  }\n\n  // Fetch wrapper\n  private makeApiCall = async (method: string, endpoint: string, data: any = {}): Promise<any> => {\n    const url = `${SERVER_API_URL}${endpoint}`;\n    \n    const headers: Headers = new Headers();\n    headers.append('Content-Type', 'application/json');\n\n    const requestOptions: RequestInit = {\n      method,\n      headers,\n      credentials: 'include', // Include http-only cookies\n    };\n    if (method === 'POST') {\n      requestOptions.body = JSON.stringify(data);\n    }\n    \n    const response = await fetch(url, requestOptions);\n    if(response.status === 401) {\n      const errorData = await response.json();\n      if(errorData.message === 'Session has expired. Please log in again.') {\n        const refreshResponse = await fetch(`${SERVER_API_URL}/api/auth/refresh`, { method: 'POST', credentials: 'include' });\n        if (!refreshResponse.ok) {\n          throw new Error('Unable to refresh tokens');\n        }\n        const retryResponse = await fetch(url, requestOptions);\n        return retryResponse;\n      }\n    }\n    return response;\n  } \n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}